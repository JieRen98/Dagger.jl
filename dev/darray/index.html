<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Distributed Arrays · Dagger.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://JuliaParallel.github.io/Dagger.jl/darray/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Dagger.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../task-spawning/">Task Spawning</a></li><li><a class="tocitem" href="../data-management/">Data Management</a></li><li class="is-active"><a class="tocitem" href>Distributed Arrays</a><ul class="internal"><li><a class="tocitem" href="#Creating-DArrays"><span>Creating <code>DArrays</code></span></a></li><li><a class="tocitem" href="#Broadcasting"><span>Broadcasting</span></a></li></ul></li><li><a class="tocitem" href="../scopes/">Scopes</a></li><li><a class="tocitem" href="../processors/">Processors</a></li><li><a class="tocitem" href="../task-queues/">Task Queues</a></li><li><a class="tocitem" href="../propagation/">Option Propagation</a></li><li><a class="tocitem" href="../logging/">Logging and Graphing</a></li><li><a class="tocitem" href="../checkpointing/">Checkpointing</a></li><li><a class="tocitem" href="../scheduler-visualization/">Scheduler Visualization</a></li><li><a class="tocitem" href="../benchmarking/">Benchmarking</a></li><li><a class="tocitem" href="../dynamic/">Dynamic Scheduler Control</a></li><li><a class="tocitem" href="../scheduler-internals/">Scheduler Internals</a></li><li><span class="tocitem">Dagger API</span><ul><li><a class="tocitem" href="../api-dagger/types/">Types</a></li><li><a class="tocitem" href="../api-dagger/functions/">Functions and Macros</a></li></ul></li><li><span class="tocitem">TimespanLogging API</span><ul><li><a class="tocitem" href="../api-timespanlogging/types/">Types</a></li><li><a class="tocitem" href="../api-timespanlogging/functions/">Functions and Macros</a></li></ul></li><li><span class="tocitem">DaggerWebDash API</span><ul><li><a class="tocitem" href="../api-daggerwebdash/types/">Types</a></li><li><a class="tocitem" href="../api-daggerwebdash/functions/">Functions and Macros</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Distributed Arrays</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Distributed Arrays</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaParallel/Dagger.jl/blob/master/docs/src/darray.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Distributed-Arrays"><a class="docs-heading-anchor" href="#Distributed-Arrays">Distributed Arrays</a><a id="Distributed-Arrays-1"></a><a class="docs-heading-anchor-permalink" href="#Distributed-Arrays" title="Permalink"></a></h1><p>The <code>DArray</code>, or &quot;distributed array&quot;, is an abstraction layer on top of Dagger that allows loading array-like structures into a distributed environment. The <code>DArray</code> partitions a larger array into smaller &quot;blocks&quot; or &quot;chunks&quot;, and those blocks may be located on any worker in the cluster. The <code>DArray</code> uses a Parallel Global Address Space (aka &quot;PGAS&quot;) model for storing partitions, which means that a <code>DArray</code> instance contains a reference to every partition in the greater array; this provides great flexibility in allowing Dagger to choose the most efficient way to distribute the array&#39;s blocks and operate on them in a heterogeneous manner.</p><p>Aside: an alternative model, here termed the &quot;MPI&quot; model, is not yet supported, but would allow storing only a single partition of the array on each MPI rank in an MPI cluster. <code>DArray</code> support for this model is planned in the near future.</p><p>This should not be confused with the <a href="https://github.com/JuliaParallel/DistributedArrays.jl">DistributedArrays.jl</a> package.</p><h2 id="Creating-DArrays"><a class="docs-heading-anchor" href="#Creating-DArrays">Creating <code>DArrays</code></a><a id="Creating-DArrays-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-DArrays" title="Permalink"></a></h2><p>A <code>DArray</code> can be created in two ways: through an API similar to the usual <code>rand</code>, <code>ones</code>, etc. calls, or by distributing an existing array with <code>distribute</code>. Additionally, most operations on <code>DArray</code>s also return <code>DArray</code>s or an equivalent object which represents the operation being performed. It&#39;s generally not recommended to manually construct a <code>DArray</code> object unless you&#39;re developing the <code>DArray</code> itself.</p><h3 id="Allocating-new-arrays"><a class="docs-heading-anchor" href="#Allocating-new-arrays">Allocating new arrays</a><a id="Allocating-new-arrays-1"></a><a class="docs-heading-anchor-permalink" href="#Allocating-new-arrays" title="Permalink"></a></h3><p>As an example, one can allocate a random <code>DArray</code> by calling <code>rand</code> with a <code>Blocks</code> object as the first argument - <code>Blocks</code> specifies the size of partitions to be constructed. Note that the <code>DArray</code> is a lazy asynchronous object (i.e. operations on it may execute in the background), so to force it to be materialized, <code>fetch</code> may need to be called:</p><pre><code class="language-julia hljs"># Add some Julia workers
julia&gt; using Distributed; addprocs(6)
6-element Vector{Int64}:
 2
 3
 4
 5
 6
 7

julia&gt; @everywhere using Dagger

julia&gt; DX = rand(Blocks(50, 50), 100, 100)
Dagger.AllocateArray{Float64, 2}(100, 100)

julia&gt; fetch(DX)
Dagger.DArray{Any, 2, typeof(cat)}(100, 100)</code></pre><p>The <code>rand(Blocks(50, 50), 100, 100)</code> call specifies that a <code>DArray</code> matrix should be allocated which is in total 100 x 100, split into 4 blocks of size 50 x 50, and initialized with random <code>Float64</code>s. Many other functions, like <code>randn</code>, <code>ones</code>, and <code>zeros</code> can be called in this same way.</p><p>To convert a <code>DArray</code> back into an <code>Array</code>, <code>collect</code> can be used to gather the data from all the Julia workers that they&#39;re on and combine them into a single <code>Array</code> on the worker calling <code>collect</code>:</p><pre><code class="language-julia hljs">julia&gt; collect(DX)
100×100 Matrix{Float64}:
 0.610404   0.0475367  0.809016   0.311305   0.0306211   0.689645   …  0.220267   0.678548   0.892062    0.0559988
 0.680815   0.788349   0.758755   0.0594709  0.640167    0.652266      0.331429   0.798848   0.732432    0.579534
 0.306898   0.0805607  0.498372   0.887971   0.244104    0.148825      0.340429   0.029274   0.140624    0.292354
 0.0537622  0.844509   0.509145   0.561629   0.566584    0.498554      0.427503   0.835242   0.699405    0.0705192
 0.587364   0.59933    0.0624318  0.3795     0.430398    0.0853735     0.379947   0.677105   0.0305861   0.748001
 0.14129    0.635562   0.218739   0.0629501  0.373841    0.439933   …  0.308294   0.0966736  0.783333    0.00763648
 0.14539    0.331767   0.912498   0.0649541  0.527064    0.249595      0.826705   0.826868   0.41398     0.80321
 0.13926    0.353158   0.330615   0.438247   0.284794    0.238837      0.791249   0.415801   0.729545    0.88308
 0.769242   0.136001   0.950214   0.171962   0.183646    0.78294       0.570442   0.321894   0.293101    0.911913
 0.786168   0.513057   0.781712   0.0191752  0.512821    0.621239      0.50503    0.0472064  0.0368674   0.75981
 0.493378   0.129937   0.758052   0.169508   0.0564534   0.846092   …  0.873186   0.396222   0.284       0.0242124
 0.12689    0.194842   0.263186   0.213071   0.535613    0.246888      0.579931   0.699231   0.441449    0.882772
 0.916144   0.21305    0.629293   0.329303   0.299889    0.127453      0.644012   0.311241   0.713782    0.0554386
 ⋮                                                       ⋮          ⋱
 0.430369   0.597251   0.552528   0.795223   0.46431     0.777119      0.189266   0.499178   0.715808    0.797629
 0.235668   0.902973   0.786537   0.951402   0.768312    0.633666      0.724196   0.866373   0.0679498   0.255039
 0.605097   0.301349   0.758283   0.681568   0.677913    0.51507    …  0.654614   0.37841    0.86399     0.583924
 0.824216   0.62188    0.369671   0.725758   0.735141    0.183666      0.0401394  0.522191   0.849429    0.839651
 0.578047   0.775035   0.704695   0.203515   0.00267523  0.869083      0.0975535  0.824887   0.00787017  0.920944
 0.805897   0.0275489  0.175715   0.135956   0.389958    0.856349      0.974141   0.586308   0.59695     0.906727
 0.212875   0.509612   0.85531    0.266659   0.0695836   0.0551129     0.788085   0.401581   0.948216    0.00242077
 0.512997   0.134833   0.895968   0.996953   0.422192    0.991526   …  0.838781   0.141053   0.747722    0.84489
 0.283221   0.995152   0.61636    0.75955    0.072718    0.691665      0.151339   0.295759   0.795476    0.203072
 0.0946639  0.496832   0.551496   0.848571   0.151074    0.625696      0.673817   0.273958   0.177998    0.563221
 0.0900806  0.127274   0.394169   0.140403   0.232985    0.460306      0.536441   0.200297   0.970311    0.0292218
 0.0698985  0.463532   0.934776   0.448393   0.606287    0.552196      0.883694   0.212222   0.888415    0.941097</code></pre><h3 id="Distributing-existing-arrays"><a class="docs-heading-anchor" href="#Distributing-existing-arrays">Distributing existing arrays</a><a id="Distributing-existing-arrays-1"></a><a class="docs-heading-anchor-permalink" href="#Distributing-existing-arrays" title="Permalink"></a></h3><p>Now let&#39;s look at constructing a <code>DArray</code> from an existing array object; we can do this by calling <code>Distribute</code>:</p><pre><code class="language-julia hljs">julia&gt; Z = zeros(100, 500);

julia&gt; Dzeros = Distribute(Blocks(10, 50), Z)
Distribute{Float64, 2}(100, 500)

julia&gt; fetch(Dzeros)
Dagger.DArray{Any, 2, typeof(cat)}(100, 500)</code></pre><p>If we wanted to skip having to call <code>fetch</code>, we could just call <code>distribute</code>, which blocks until distributing the array is completed:</p><pre><code class="language-julia hljs">julia&gt; Dzeros = distribute(Z, Blocks(10, 50))
Dagger.DArray{Any, 2, typeof(cat)}(100, 500)</code></pre><h2 id="Broadcasting"><a class="docs-heading-anchor" href="#Broadcasting">Broadcasting</a><a id="Broadcasting-1"></a><a class="docs-heading-anchor-permalink" href="#Broadcasting" title="Permalink"></a></h2><p>As the <code>DArray</code> is a subtype of <code>AbstractArray</code> and generally satisfies Julia&#39;s array interface, a variety of common operations (such as broadcast) work as expected:</p><pre><code class="language-julia hljs">julia&gt; DX = rand(Blocks(50,50), 100, 100)
Dagger.AllocateArray{Float64, 2}(100, 100)

julia&gt; DY = DX .+ DX
Dagger.BCast{Base.Broadcast.Broadcasted{Dagger.DaggerBroadcastStyle, Tuple{Base.OneTo{Int64}, Base.OneTo{Int64}}, typeof(+), Tuple{Dagger.AllocateArray{Float64, 2}, Dagger.AllocateArray{Float64, 2}}}, Float64, 2}(100, 100)

julia&gt; DZ = DY .* 3
Dagger.BCast{Base.Broadcast.Broadcasted{Dagger.DaggerBroadcastStyle, Tuple{Base.OneTo{Int64}, Base.OneTo{Int64}}, typeof(*), Tuple{Dagger.BCast{Base.Broadcast.Broadcasted{Dagger.DaggerBroadcastStyle, Tuple{Base.OneTo{Int64}, Base.OneTo{Int64}}, typeof(+), Tuple{Dagger.AllocateArray{Float64, 2}, Dagger.AllocateArray{Float64, 2}}}, Float64, 2}, Int64}}, Float64, 2}(100, 100)

julia&gt; size(DZ)
(100, 100)

julia&gt; DA = fetch(DZ)
Dagger.DArray{Any, 2, typeof(cat)}(100, 100)</code></pre><p>Now, <code>DA</code> is the lazy result of computing <code>(DX .+ DX) .* 3</code>. Note that <code>DArray</code> objects are immutable, and operations on them are thus functional transformations of their input <code>DArray</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Support for mutation of <code>DArray</code>s is planned for a future release</p></div></div><p>Additionally, note that we can still call <code>size</code> on these lazy <code>BCast</code> objects, as it&#39;s clear what the final output&#39;s size will be.</p><pre><code class="nohighlight hljs">julia&gt; Dagger.chunks(DA)
2×2 Matrix{Union{Thunk, Dagger.Chunk}}:
 Chunk{Matrix{Float64}, DRef, ThreadProc, AnyScope}(Matrix{Float64}, ArrayDomain{2}((1:50, 1:50)), DRef(4, 8, 0x0000000000004e20), ThreadProc(4, 1), AnyScope(), true)  …  Chunk{Matrix{Float64}, DRef, ThreadProc, AnyScope}(Matrix{Float64}, ArrayDomain{2}((1:50, 1:50)), DRef(2, 5, 0x0000000000004e20), ThreadProc(2, 1), AnyScope(), true)
 Chunk{Matrix{Float64}, DRef, ThreadProc, AnyScope}(Matrix{Float64}, ArrayDomain{2}((1:50, 1:50)), DRef(5, 5, 0x0000000000004e20), ThreadProc(5, 1), AnyScope(), true)     Chunk{Matrix{Float64}, DRef, ThreadProc, AnyScope}(Matrix{Float64}, ArrayDomain{2}((1:50, 1:50)), DRef(3, 3, 0x0000000000004e20), ThreadProc(3, 1), AnyScope(), true)</code></pre><p>Here we can see the <code>DArray</code>&#39;s internal representation of the partitions, which are stored as Dagger <code>Chunk</code> objects (which, as a reminder, may reference data which exists on other Julia workers). One doesn&#39;t typically need to worry about these internal details unless implementing operators on <code>DArray</code>s.</p><p>Finally, it&#39;s all the same to get the result of this complicated set of broadcast operations; just use <code>fetch</code> to get a <code>DArray</code>, and <code>collect</code> to get an <code>Array</code>:</p><pre><code class="nohighlight hljs">julia&gt; DA *= 2
Dagger.BCast{Base.Broadcast.Broadcasted{Dagger.DaggerBroadcastStyle, Tuple{Base.OneTo{Int64}, Base.OneTo{Int64}}, typeof(*), Tuple{Dagger.DArray{Any, 2, typeof(cat)}, Int64}}, Any, 2}(100, 100)

julia&gt; fetch(DA)
Dagger.DArray{Any, 2, typeof(cat)}(100, 100)

julia&gt; collect(DA)
100×100 Matrix{Float64}:
 11.6021    9.12356    0.407394  11.2524     4.89022   …   3.26229    1.23314    1.96686    3.04927   3.65649
  3.78571   6.24751    2.74505    8.3009    11.4331        0.336563   9.37329    2.84604    8.52946  10.9168
  3.9987    0.641359   3.1918    11.4368     4.41555       1.12344    5.44424    3.49739    3.32251   8.86685
  7.90953   1.50281    1.91451    4.89621    9.44033       2.97169    9.68018   11.8686     4.74035   8.49143
  1.0611    5.5909    10.364      5.48194    6.821         0.66667    5.33619    5.56166    8.19974   7.02791
  7.47418  11.3061     7.9809     2.34617    7.90996   …   6.30402   10.2203     4.92873    8.22024   7.41224
  7.06002   0.604601  11.6572     4.95498    0.671179      5.42867    8.19648    0.611793  11.9469    1.6628
  2.97898   0.738068   4.44802    5.81322    7.3991        8.71256    2.48281   11.0882    10.9801   11.2464
  1.34064   7.37116    1.14921    3.95358    9.73416       7.83354   10.8357     0.270462   9.93926   9.05206
  8.77125   0.44711   11.7197    11.6632     8.21711       2.20143    5.06451    3.92386    3.90197   4.32807
 10.6201    4.82176    8.4164    10.5457     2.65546   …  10.4681     1.00604    7.05816    6.33214   4.13517
 10.6633   10.2059     7.06543    1.58093    5.33819       7.86821    9.56034    2.37929    4.39098  11.6246
 11.1778    6.76896   10.249     11.3147     9.7838        6.17893    0.433731   0.713574   9.99747   0.570143
  ⋮                                                    ⋱   ⋮
  6.19119  11.027     10.0742     3.51595    0.48755       3.56015    7.43083    0.624126   9.0292    3.04445
  3.38276   5.32876    2.66453    4.08388    6.51538      10.8722     5.14729    3.7499     7.11074  11.3595
  4.10258   0.474511   0.852416   4.79806    5.21663   …   9.96304    5.82279    0.818069   9.85573   8.9645
  6.03249   8.82392    2.14424   10.7512     8.28873       8.32419    2.96016    4.97967    2.52393   2.31372
  7.25826   8.49308    3.90884    3.03783    3.67546       6.63201    5.18839    1.99734    8.51863   8.7656
 11.6969    1.29504    0.745432   0.119002   6.11005       5.3909     2.61199   11.5168     8.25466   2.29896
 10.7       9.66697    2.34518    6.68043    4.09362      11.6484     2.53879    9.95172    3.97177   9.53493
 11.652     3.53655    8.38743    3.75028   11.8518    …   3.11588    1.07276    8.12898    8.80697   1.50331
  9.69158  11.2718     8.98014    2.71964    4.11854       0.840723   4.55286    4.47269    8.30213   0.927262
 10.5868   11.9395     8.22633    6.71811    9.6942        2.2561     0.233772   1.76577    9.67937   8.29349
  9.19925   5.77384    2.18139   10.3563     6.7716        9.8496    11.3777     6.43372   11.2769    4.82911
  9.15905   8.12721   11.1374     6.32082    3.49716       7.23124   10.3995     6.98103    7.72209   6.08033</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../data-management/">« Data Management</a><a class="docs-footer-nextpage" href="../scopes/">Scopes »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 18 July 2023 18:25">Tuesday 18 July 2023</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
